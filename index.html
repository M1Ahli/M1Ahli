<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            dark: {
              bg: '#111827',
              surface: '#1f2937',
              border: '#374151',
              text: '#f3f4f6',
              muted: '#9ca3af',
              input: '#111827'
            }
          }
        }
      }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;500;700&display=swap');
    body { font-family: 'Tajawal','Cairo',system-ui,sans-serif; background:#f9fafb; color:#111827; transition: background-color 0.3s, color 0.3s; }
    /* Dark Mode */
    body.dark-mode { background-color: #111827; color: #f3f4f6; }
    body.dark-mode .bg-white, body.dark-mode .modal-content { background-color: #1f2937 !important; color: #f3f4f6 !important; border-color: #374151 !important; }
    body.dark-mode .bg-gray-50 { background-color: #111827 !important; }
    body.dark-mode .bg-gray-100 { background-color: #374151 !important; color: white !important; }
    body.dark-mode th { background-color: #1f2937 !important; color: #9ca3af !important; border-bottom-color: #374151 !important; }
    body.dark-mode td { border-bottom-color: #374151 !important; }
    body.dark-mode input, body.dark-mode select, body.dark-mode textarea { background-color: #111827 !important; border-color: #4b5563 !important; color: #fff !important; }
    body.dark-mode input::placeholder, body.dark-mode textarea::placeholder { color: #6b7280 !important; }

    nav { background:#ffffff; border-radius:16px; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05); padding:12px; display:flex; flex-wrap:wrap; gap:10px; margin-bottom: 20px; transition: background-color 0.3s, color 0.3s; }
    body.dark-mode nav { background-color: #1f2937 !important; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.3); }

    .nav-btn { border-radius:8px; font-weight:600; padding:8px 16px; transition:all .2s; background:#f3f4f6; color:#4b5563; border: 1px solid transparent; }
    .nav-btn:hover { background:#e5e7eb; transform:translateY(-1px); }
    .nav-btn.active { background:#7c3aed; color:#fff; box-shadow:0 4px 12px rgba(124, 58, 237, 0.3); }
    body.dark-mode .nav-btn { background:#374151; color:#d1d5db; }
    body.dark-mode .nav-btn:hover { background:#4b5563; color: white; }
    body.dark-mode .nav-btn.active { background:#8b5cf6; color:#fff; box-shadow:0 4px 12px rgba(139, 92, 246, 0.4); }

    .bg-white { border-radius:16px; box-shadow:0 1px 3px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); }
    table { border-collapse:separate; border-spacing:0; width:100%; font-size:.9rem; }
    th { background:#f9fafb; font-weight:700; text-align:right; padding:12px 16px; border-bottom:2px solid #e5e7eb; color: #4b5563; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.05em; }
    td { padding:12px 16px; border-bottom:1px solid #f3f4f6; vertical-align: middle; }
    .badge { padding:.25rem .6rem; border-radius:9999px; font-size:.7rem; font-weight:700; display:inline-flex; align-items:center; gap:4px; }
    .hidden { display:none !important; }
    .table-wrap { overflow-x:auto; border-radius: 12px; border: 1px solid #e5e7eb; }
    body.dark-mode .table-wrap { border-color: #374151; }
    .truncate-text { max-width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .rotate-0 { transform: rotate(0deg); }
    .-rotate-90 { transform: rotate(90deg); }
    @media print { body * { visibility: hidden; } #printable-area, #printable-area * { visibility: visible; } #printable-area { position: absolute; left: 0; top: 0; width: 100%; } .no-print { display: none !important; } }
  </style>
</head>
<body class="p-4 md:p-6 max-w-[1600px] mx-auto transition-colors duration-300">

  <nav>
    <button id="nav-dashboard" class="nav-btn active" onclick="showView('dashboard')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button id="nav-properties" class="nav-btn" onclick="showView('properties')">ğŸ¢ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</button>
    <button id="nav-leases" class="nav-btn" onclick="showView('leases')">ğŸ“‘ Ø§Ù„Ø¹Ù‚ÙˆØ¯</button>
    <button id="nav-tenants" class="nav-btn" onclick="showView('tenants')">ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ†</button>
    <button id="nav-cheques" class="nav-btn" onclick="showView('cheques')">ğŸ’³ Ø§Ù„Ø´ÙŠÙƒØ§Øª</button>
    <button id="nav-payments" class="nav-btn" onclick="showView('payments')">ğŸ’° Ø§Ù„Ø¯ÙØ¹Ø§Øª</button>
    <button id="nav-expenses" class="nav-btn" onclick="showView('expenses')">ğŸ’¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
    <button id="nav-salaries" class="nav-btn" onclick="showView('salaries')">ğŸ‘¨â€ğŸ”§ Ø§Ù„Ø±ÙˆØ§ØªØ¨</button>
    <button id="nav-receipts-history" class="nav-btn" onclick="showView('receipts-history')">ğŸ§¾ Ø§Ù„Ø³Ù†Ø¯Ø§Øª</button>
    <button id="nav-reports" class="nav-btn" onclick="showView('reports')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
    <button id="nav-settings" class="nav-btn" onclick="showView('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <button class="nav-btn mr-auto" onclick="toggleDarkMode()">ğŸŒ™/â˜€ï¸</button>
  </nav>

  <!-- Dashboard -->
  <section id="dashboard-view" class="view">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h2>
      <span class="text-sm text-gray-500 dark:text-gray-400" id="current-date-display"></span>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white p-6 rounded-2xl border-r-4 border-emerald-500">
        <p class="text-gray-500 dark:text-gray-400 text-sm font-semibold mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙŠ</p>
        <p id="total-annual-rent" class="text-3xl font-bold text-gray-800 dark:text-white">0 AED</p>
      </div>
      <div class="bg-white p-6 rounded-2xl border-r-4 border-blue-500">
        <p class="text-gray-500 dark:text-gray-400 text-sm font-semibold mb-1">Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„ÙØ¹Ø§Ù„Ø©</p>
        <p id="active-leases-count" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
      </div>
      <div class="bg-white p-6 rounded-2xl border-r-4 border-rose-500">
        <p class="text-gray-500 dark:text-gray-400 text-sm font-semibold mb-1">Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø´Ø§ØºØ±Ø©</p>
        <p id="empty-units-count" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
      </div>
      <div class="bg-white p-6 rounded-2xl border-r-4 border-amber-500">
        <p class="text-gray-500 dark:text-gray-400 text-sm font-semibold mb-1">Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†</p>
        <p id="late-tenants-count" class="text-3xl font-bold text-gray-800 dark:text-white">0</p>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white p-6 rounded-2xl">
        <h3 class="font-bold mb-4 text-gray-700 dark:text-gray-200">ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h3>
        <div class="h-64"><canvas id="leasesChart"></canvas></div>
      </div>
      <div class="bg-white p-6 rounded-2xl">
        <h3 class="font-bold mb-4 text-gray-700 dark:text-gray-200">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ</h3>
        <div class="h-64"><canvas id="financeChart"></canvas></div>
      </div>
    </div>

    <div class="bg-white p-6 rounded-2xl">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-gray-700 dark:text-gray-200">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø®ÙŠØ±</h3>
        <button onclick="clearLogs()" class="text-xs text-rose-600 hover:underline">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
      </div>
      <ul id="contractLogs" class="space-y-2 text-sm text-gray-600 dark:text-gray-400 max-h-48 overflow-y-auto pr-2"></ul>
    </div>
  </section>

  <!-- Properties -->
  <section id="properties-view" class="view hidden">
    <div class="flex flex-wrap items-center justify-between mb-6 gap-4">
      <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆØ§Ù„ÙˆØ­Ø¯Ø§Øª</h2>
      <div class="flex flex-wrap gap-2 items-center">
        <div class="flex bg-white rounded-lg shadow border border-gray-100 dark:border-gray-700 p-0.5 ml-2">
          <button onclick="expandAllProperties()" class="px-3 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" title="ØªÙˆØ³ÙŠØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª">ğŸ”½ ØªÙˆØ³ÙŠØ¹</button>
          <div class="w-px bg-gray-200 dark:bg-gray-700 my-1"></div>
          <button onclick="collapseAllProperties()" class="px-3 py-1.5 text-xs font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" title="Ø·ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª">â—€ï¸ Ø·ÙŠ</button>
        </div>
        <div class="relative">
          <input type="text" id="prop-search" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹..." class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 w-56 text-sm" oninput="renderProperties()">
          <span class="absolute left-3 top-2.5 text-gray-400 text-sm">ğŸ”</span>
        </div>
        <button onclick="openPropertyModal()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg shadow flex items-center gap-2 text-sm"><span>+</span> Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±</button>
      </div>
    </div>
    <div id="properties-container" class="space-y-6"></div>
  </section>

  <!-- Minimal other sections (kept same structure) -->
  <section id="leases-view" class="view hidden">...</section>
  <section id="tenants-view" class="view hidden">...</section>
  <section id="cheques-view" class="view hidden">...</section>
  <section id="payments-view" class="view hidden">...</section>
  <section id="expenses-view" class="view hidden">...</section>
  <section id="salaries-view" class="view hidden">...</section>
  <section id="receipts-history-view" class="view hidden">...</section>
  <section id="receipt-view" class="view hidden">...</section>
  <section id="reports-view" class="view hidden">...</section>
  <section id="settings-view" class="view hidden">...</section>

  <!-- Property Modal (kept minimal and valid) -->
  <div id="property-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white modal-content rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
      <div class="p-6 border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center">
        <h3 class="text-xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</h3>
        <button onclick="closePropertyModal()" class="text-gray-400 hover:text-gray-600">âœ•</button>
      </div>
      <form id="property-form" class="p-6 grid grid-cols-1 gap-4">
        <input id="prop-id" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¹Ù‚Ø§Ø± (Ù…Ø«Ø§Ù„: PRP001)" class="border p-2 rounded w-full" required>
        <input id="prop-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±" class="border p-2 rounded w-full" required>
        <div class="grid grid-cols-2 gap-4">
          <input id="prop-type" placeholder="Ø§Ù„Ù†ÙˆØ¹ (ÙÙŠÙ„Ø§/Ø¨Ù†Ø§ÙŠØ©)" class="border p-2 rounded">
          <input id="prop-usage" placeholder="Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…" class="border p-2 rounded">
        </div>
        <input id="prop-location" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹" class="border p-2 rounded">
        <div class="flex justify-end gap-3 mt-4">
          <button type="button" onclick="closePropertyModal()" class="px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="px-6 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 shadow">Ø­ÙØ¸</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ================= DATA & STORAGE =================
    const initialProperties = [
      { id: 'PRP65351', name: 'ÙÙŠÙ„Ø§', type: 'ÙÙŠÙ„Ø§', usage: 'Ø³ÙƒÙ† Ø®Ø§Øµ', location: 'Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¹ÙŠÙ† - ÙÙ„Ø¬ Ù‡Ø²Ø§Ø¹', units: [ { id: 'PRP65351_U1', name: 'ÙÙŠÙ„Ø§', type: 'ÙÙŠÙ„Ø§', usage: 'Ø³ÙƒÙ†ÙŠ', status: 'Ù…Ø¤Ø¬Ø±Ø©', tenant: 'HAMDAN ABDULLA', rent: 100000, contractNo: '202401001', start: '2024-01-01', end: '2025-01-01' } ] },
      { id: 'PRP11751', name: 'Ø¨Ù†Ø§ÙŠØ© Ø²Ù‡Ø±Ø§Ø¡ ÙˆÙ„Ø·ÙŠÙØ©', type: 'Ø¨Ù†Ø§ÙŠØ©', usage: 'ØªØ¬Ø§Ø±ÙŠ', location: 'Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¹ÙŠÙ† - Ø¨Ø·Ø­Ø§Ø¡ Ø§Ù„Ø­Ø§Ø¦Ø±', units: [ { id: 'UNT83591', name: '10-A', type: 'Ù…ÙƒØªØ¨', usage: 'ØªØ¬Ø§Ø±ÙŠ', status: 'Ø´Ø§ØºØ±Ø©' }, { id: 'UNT83609', name: '10-B', type: 'Ù…ÙƒØªØ¨', usage: 'ØªØ¬Ø§Ø±ÙŠ', status: 'Ù…Ø¤Ø¬Ø±Ø©', tenant: 'KASHMIR AL KHDHRA', rent: 9000, contractNo: '202501709877', start: '2025-01-01', end: '2026-01-01' } ] }
    ];

    let properties = [];
    let contractLogs = JSON.parse(localStorage.getItem('logs') || '[]');

    function saveToLocal(){
      localStorage.setItem('re_data_v2', JSON.stringify({ properties }));
    }
    function loadFromLocal(){
      const d = localStorage.getItem('re_data_v2');
      if(d){
        try { const o = JSON.parse(d); if(o.properties) properties = o.properties; else properties = JSON.parse(JSON.stringify(initialProperties)); }
        catch(e){ console.error(e); properties = JSON.parse(JSON.stringify(initialProperties)); }
      } else { properties = JSON.parse(JSON.stringify(initialProperties)); saveToLocal(); }
    }

    function formatAED(n){ return (n||0).toLocaleString('en-US') + ' AED'; }
    function logAction(msg){ contractLogs.unshift({m:msg, t:new Date().toISOString()}); if(contractLogs.length>50) contractLogs.pop(); localStorage.setItem('logs', JSON.stringify(contractLogs)); renderLogs(); }
    function clearLogs(){ contractLogs=[]; localStorage.setItem('logs','[]'); renderLogs(); }

    // ================= VIEW LOGIC =================
    function showView(id){ document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden')); const el = document.getElementById(id+'-view'); if(el) el.classList.remove('hidden'); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); const navBtn = document.getElementById('nav-'+id); if(navBtn) navBtn.classList.add('active'); if(id==='dashboard') updateDashboard(); if(id==='properties') renderProperties(); }

    // Dashboard charts
    let leasesChart, financeChart;
    function updateDashboard(){
      document.getElementById('current-date-display').textContent = new Date().toLocaleDateString('ar-AE', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
      renderLogs();
      const stats = { active:0, empty:0, expired:0, totalRent:0 };
      properties.forEach(p=>p.units.forEach(u=>{ if(u.status==='Ù…Ø¤Ø¬Ø±Ø©'){ stats.active++; stats.totalRent += (u.rent||0); } else if(u.status==='Ù…Ù†ØªÙ‡ÙŠØ©') stats.expired++; else stats.empty++; }));
      document.getElementById('total-annual-rent').textContent = formatAED(stats.totalRent);
      document.getElementById('active-leases-count').textContent = stats.active;
      document.getElementById('empty-units-count').textContent = stats.empty;
      const ctx1 = document.getElementById('leasesChart').getContext('2d'); if(leasesChart) leasesChart.destroy(); leasesChart = new Chart(ctx1, { type: 'doughnut', data: { labels:['Ù…Ø¤Ø¬Ø±Ø©','Ø´Ø§ØºØ±Ø©','Ù…Ù†ØªÙ‡ÙŠØ©'], datasets:[{ data:[stats.active, stats.empty, stats.expired], backgroundColor:['#10b981','#e5e7eb','#f43f5e'], borderColor:'#fff' }] }, options:{ plugins:{ legend:{ position:'left' } } } });
      const collected = 0; const ctx2 = document.getElementById('financeChart').getContext('2d'); if(financeChart) financeChart.destroy(); financeChart = new Chart(ctx2, { type:'bar', data:{ labels:['Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø³Ù†ÙˆÙŠØ§Ù‹','Ø§Ù„Ù…Ù‚Ø¨ÙˆØ¶ ÙØ¹Ù„ÙŠØ§Ù‹'], datasets:[{ label:'AED', data:[stats.totalRent, collected], backgroundColor:['#3b82f6','#10b981'] }] }, options:{ scales:{ y:{ beginAtZero:true } } } });
    }

    function renderLogs(){ const el=document.getElementById('contractLogs'); el.innerHTML=''; contractLogs.forEach(l=>{ const li = document.createElement('li'); li.innerHTML = `<span class="text-xs text-gray-400 font-mono">[${new Date(l.t).toLocaleTimeString('ar-AE')}]</span> ${l.m}`; el.appendChild(li); }); }

    function renderProperties(){ const container = document.getElementById('properties-container'); container.innerHTML=''; const search = (document.getElementById('prop-search')?.value||'').toLowerCase(); properties.forEach(p=>{ const filteredUnits = p.units.filter(u=> u.name.toLowerCase().includes(search) || (u.tenant||'').toLowerCase().includes(search)); if(search && filteredUnits.length===0) return; const contentId = `units-content-${p.id}`; const iconId = `icon-${p.id}`; const card = document.createElement('div'); card.className = 'bg-white dark:bg-dark-surface rounded-2xl shadow-sm border border-gray-100 dark:border-dark-border overflow-hidden transition-all duration-200 hover:shadow-md'; let unitsHTML = (search?filteredUnits:p.units).map(u=>`<tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors"><td class="px-4 py-3 font-bold text-gray-700 dark:text-gray-200">${u.name}</td><td class="px-4 py-3 text-xs text-gray-500 dark:text-gray-400">${u.type||'-'}</td><td class="px-4 py-3"><span class="px-2 py-1 rounded text-[10px] font-bold">${u.status}</span></td><td class="px-4 py-3 text-sm max-w-[150px] truncate" title="${u.tenant||''}">${u.tenant||'-'}</td><td class="px-4 py-3 font-mono text-emerald-700 dark:text-emerald-400 font-bold text-sm">${u.rent?u.rent.toLocaleString():'-'}</td><td class="px-4 py-3 text-xs font-mono truncate-text text-gray-500 dark:text-gray-400" title="${u.contractNo||''}">${u.contractNo||'-'}</td><td class="px-4 py-3 text-[10px] text-gray-400"><div class="flex flex-col"><span>${u.start||'--'}</span><span>${u.end||'--'}</span></div></td><td class="px-4 py-3"><div class="flex gap-1"><button onclick="openUnitModal('${p.id}','${u.id}')" class="p-1.5 hover:bg-blue-50 text-blue-600 rounded">âœï¸</button></div></td></tr>`).join('');
      card.innerHTML = `
        <div class="p-4 bg-gray-50 dark:bg-dark-surface border-b dark:border-dark-border flex justify-between items-center cursor-pointer select-none" onclick="toggleUnitVisibility('${p.id}')">
          <div class="flex items-center gap-3">
            <div id="${iconId}" class="transition-transform duration-300 transform rotate-0 text-gray-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>
            <div>
              <div class="flex items-center gap-2"><h3 class="text-lg font-bold text-gray-800 dark:text-white">${p.name}</h3><span class="bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-[10px] px-2 py-0.5 rounded-full font-mono">${p.id}</span></div>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ğŸ“ ${p.location||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | ğŸ¢ ${p.units.length} ÙˆØ­Ø¯Ø§Øª</p>
            </div>
          </div>
          <div class="flex gap-2" onclick="event.stopPropagation()">
            <button onclick="openUnitModal('${p.id}')" class="bg-white dark:bg-dark-surface border border-emerald-200 text-emerald-700 hover:bg-emerald-50 px-2 py-1 rounded">ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button onclick="deleteProperty('${p.id}')" class="bg-white dark:bg-dark-surface border border-red-200 text-red-600 hover:bg-red-50 px-2 py-1 rounded">Ø­Ø°Ù</button>
          </div>
        </div>
        <div id="${contentId}" class="p-4 transition-all duration-300 ease-in-out">
          <div class="table-wrap border rounded-lg">
            <table class="w-full"><thead class="bg-gray-50 text-xs text-gray-500 uppercase"><tr><th class="px-4 py-2">Ø§Ù„ÙˆØ­Ø¯Ø©</th><th class="px-4 py-2">Ø§Ù„Ù†ÙˆØ¹</th><th class="px-4 py-2">Ø§Ù„Ø­Ø§Ù„Ø©</th><th class="px-4 py-2">Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±</th><th class="px-4 py-2">Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th class="px-4 py-2">Ø§Ù„Ø¹Ù‚Ø¯</th><th class="px-4 py-2">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</th><th class="px-4 py-2">ØªØ­ÙƒÙ…</th></tr></thead><tbody class="divide-y divide-gray-100">${unitsHTML}</tbody></table>
          </div>
        </div>`;
      container.appendChild(card);
    }); }

    function toggleUnitVisibility(propId){ const content = document.getElementById(`units-content-${propId}`); const icon = document.getElementById(`icon-${propId}`); if(!content) return; if(content.classList.contains('hidden')){ content.classList.remove('hidden'); icon?.classList.remove('-rotate-90'); icon?.classList.add('rotate-0'); } else { content.classList.add('hidden'); icon?.classList.remove('rotate-0'); icon?.classList.add('-rotate-90'); } }

    function expandAllProperties(){ properties.forEach(p=>{ const content = document.getElementById(`units-content-${p.id}`); const icon = document.getElementById(`icon-${p.id}`); if(content) content.classList.remove('hidden'); if(icon){ icon.classList.remove('-rotate-90'); icon.classList.add('rotate-0'); } }); }
    function collapseAllProperties(){ properties.forEach(p=>{ const content = document.getElementById(`units-content-${p.id}`); const icon = document.getElementById(`icon-${p.id}`); if(content) content.classList.add('hidden'); if(icon){ icon.classList.remove('rotate-0'); icon.classList.add('-rotate-90'); } }); }

    // Modals
    function openPropertyModal(){ document.getElementById('property-modal').classList.remove('hidden'); }
    function closePropertyModal(){ document.getElementById('property-modal').classList.add('hidden'); }

    function deleteProperty(id){ if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±ØŸ')) return; properties = properties.filter(p=>p.id!==id); saveToLocal(); renderProperties(); logAction(`Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø± ${id}`); }

    // Init
    loadFromLocal(); renderProperties(); updateDashboard();

    // Dark mode toggle
    function toggleDarkMode(){ document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', document.body.classList.contains('dark-mode')?'1':'0'); }
    // Restore preference
    if(localStorage.getItem('darkMode')==='1') document.body.classList.add('dark-mode');

    // Form submit for adding property
    document.getElementById('property-form').addEventListener('submit', function(e){ e.preventDefault(); const id = document.getElementById('prop-id').value.trim(); const name = document.getElementById('prop-name').value.trim(); if(!id||!name){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² ÙˆØ§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±'); return; } properties.push({ id, name, type: document.getElementById('prop-type').value, usage: document.getElementById('prop-usage').value, location: document.getElementById('prop-location').value, units: [] }); saveToLocal(); renderProperties(); closePropertyModal(); logAction(`Ø£Ø¶Ù Ø¹Ù‚Ø§Ø± ${id}`); this.reset(); });

  </script>
</body>
</html>